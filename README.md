# TaskFlow - All-in-One Productivity & Life Management System

TaskFlow is a comprehensive, modern productivity platform that goes beyond simple task management. It's your personal command center for life optimization, combining intelligent task organization, fitness tracking, nutrition monitoring, AI assistance, and gamified progress tracking‚Äîall wrapped in a beautiful, offline-capable Progressive Web App.

Whether you're planning your day, tracking your workouts, monitoring your nutrition, or getting AI-powered productivity insights, TaskFlow brings everything together in one seamless, distraction-free experience. Built with cutting-edge technologies and designed for both desktop and mobile, it adapts to your workflow and keeps you productive even without an internet connection.

## ‚ú® What Makes TaskFlow Special

- **üåê Offline-First**: Full offline functionality with PWA support‚Äîwork anywhere, anytime, even without internet
- **ü§ñ AI-Powered**: Integrated AI assistant with multi-model support (GPT, Claude, Gemini) for intelligent productivity insights
- **üèãÔ∏è Holistic Approach**: Not just tasks‚Äîtrack workouts, nutrition, and habits all in one beautiful interface
- **üìä Gamification**: Earn points, maintain streaks, unlock achievements, and rate your task experiences
- **‚ö° Lightning Fast**: Optimistic UI updates, instant feedback, and smooth animations for delightful UX
- **üé® Beautiful Design**: Modern dark theme with polished animations and attention to detail
- **üì± True PWA**: Install on any device, get push notifications, and enjoy native app experience
- **üîê Privacy First**: Your data is yours‚Äîsecure Firebase backend with granular security rules

## üöÄ Core Capabilities at a Glance

| Feature           | Description                                                                |
| ----------------- | -------------------------------------------------------------------------- |
| **Smart Tasks**   | Advanced scheduling, repeating tasks, priorities, tags, and risk detection |
| **Today View**    | Visual 24-hour timeline with time-blocking and drag-and-drop scheduling    |
| **Gym Tracking**  | Workout logging, templates, exercise library, and progress visualization   |
| **Nutrition**     | USDA food database, macro tracking, meal logging, and daily goals          |
| **AI Assistant**  | Multi-model AI with function calling and contextual help                   |
| **Analytics**     | Streaks, achievements, completion rates, and performance insights          |
| **Notifications** | Smart notification system with priority levels and inbox management        |

## üåü Key Features

### 1. Smart Task Management

- **Comprehensive Task Creation**: Create tasks with titles, detailed descriptions, due dates, specific start times, and estimated durations.
- **Visual Organization**: Assign custom icons and colors for quick visual identification and categorization.
- **Prioritization**: Mark tasks as high-priority to keep focus on what matters most.
- **Advanced Scheduling**:
  - **Repeating Tasks**: Define complex repetition rules, including daily/weekly intervals, specific days of the week, or a target number of completions per week.
  - **Manual Rescheduling**: Easily delay tasks, with tracking for how many times a task has been postponed.
- **Status & Progress Tracking**:
  - Monitor task status as `pending`, `completed`, or `delayed`.
  - Set reminders for important deadlines.
- **Gamification & Feedback Loop**:
  - **Experience Points**: Earn points for completing tasks, contributing to your overall progress and unlocking achievements.
  - **Task Experience Rating**: After completing a task, rate your experience (`bad`, `okay`, `good`, `best`) to reflect on your performance and mood.
- **Contextual Details**: Add optional information like location to your tasks.
- **Risk Identification**: The system automatically flags tasks that are at risk of being missed, helping you proactively manage your workload.

### 2. Advanced Tagging & Customization

- **Custom Tags**: Create personalized tags for tasks (e.g., morning routine, gym, personal, health, work).
- **Color Coding**: Custom color palette for visual task organization.
- **Icon Selection**: Choose from a wide range of task icons for better visual organization.

### 3. Advanced Notification System

- **Smart Notifications**: Intelligent, contextual alerts based on task behavior and patterns.
- **Multiple Notification Types**:
  - **Task Alerts**: Overdue, due soon, and at-risk notifications for repeating tasks.
  - **Gamification Alerts**: Streak milestones, achievements unlocked, and weekly performance summaries.
  - **System Alerts**: Important announcements and updates.
- **Priority Levels**: Notifications are categorized as `URGENT`, `HIGH`, `MEDIUM`, or `LOW`, with clear visual indicators.
- **Real-time Inbox**: A central hub for all notifications, featuring:
  - Unread counts broken down by priority and type.
  - Filtering and search capabilities.
  - Archiving and read/unread status management.
- **Automatic Generation & Cleanup**: Notifications are automatically created by system triggers and expired ones are removed to keep the inbox relevant.

### 4. Progress Tracking & Analytics

- **Gamification Engine**:
  - **Streak System**: Tracks current and best streaks for daily task completion, encouraging consistency.
  - **Points System**: Earn reward points for completing tasks, which contribute to unlocking achievements.
  - **Achievements**: Unlock milestones for task completion, consistency, and point accumulation.
- **Performance Metrics**:
  - **Consistency Stats**: View current and best streak lengths in days.
  - **Time Management Stats**: Analyze on-time completion rates and average task delay times.
  - **Dashboard Analytics**: Visual charts and stats provide an at-a-glance overview of your productivity.
- **Detailed Activity Log**: A comprehensive, immutable log of all task interactions, including creation, updates, completion, delays, and deletions, providing a full audit trail of your work.

### 5. Health & Nutrition Tracker

- **Calorie & Macro Tracking**: Comprehensive nutrition tracking integrated directly into your productivity workflow.
- **Daily Nutrition Dashboard**:
  - Visual progress bars showing calories, protein, carbs, and fat intake vs. goals.
- **Meal Logging**:
  - Log foods for breakfast, lunch, dinner, or snacks.
  - Flexible serving sizes with custom units.
  - Automatic nutrient calculation based on serving size.
- **Goal Setting**: Set personalized daily targets for calories and macronutrients.
- **Daily History**: View and manage your complete meal log for any date.

### 6. Advanced Gym Tracking Module

- **Comprehensive Workout Logging**:

  - **Workout Sessions**: Create and track detailed workout sessions with duration, exercises, sets, reps, and weights.
  - **Exercise Library**: Access to extensive exercise database with categories and muscle group targeting.
  - **Real-time Workout Timer**: Built-in workout duration tracking and rest timers between sets.
  - **Session Notes**: Add personal notes and observations to each workout session.

- **Workout Templates**:

  - **Template Creation**: Save frequently used workout routines as reusable templates.
  - **Quick Start**: Launch workouts instantly from saved templates with pre-loaded exercises.
  - **Template Management**: Organize and categorize workout templates by type (Push, Pull, Legs, etc.).

- **Progress Visualization & Analytics**:

  - **Interactive Charts**: Visualize progress over time with line graphs showing weight, volume, and strength trends.
  - **Exercise-Specific Analysis**: Detailed progress tracking for individual exercises with historical data.

- **Progressive Overload Intelligence**:

  - **Smart Suggestions**: AI-powered recommendations based on previous performance data.
  - **Last Performance Hints**: See your previous workout stats for each exercise to guide progressive overload.
  - **Strength Progression**: Automatic suggestions for weight and rep increases based on historical data.

- **Dashboard & Analytics**:
  - **Weekly Overview**: Calendar view showing workout frequency and consistency.
  - **Workout Statistics**: Track weekly workout count, total sessions, and average duration.
  - **Recent Activity**: Quick access to recent workouts and performance summaries.

### 7. AI Assistant & Automation

- **Intelligent Chatbot**: Built-in AI assistant powered by advanced language models (OpenAI, Claude, Gemini) for contextual help and guidance.
- **Multi-Model Support**: Choose from multiple AI providers with an intuitive model dropdown for different use cases.
- **App Navigation**: Get help navigating TaskFlow features and finding specific functionality.
- **Productivity Insights**: Receive personalized recommendations for task management and goal achievement.
- **Contextual Support**: AI understands your current app context to provide relevant assistance.
- **Chat History**: Persistent conversation history for ongoing productivity coaching.
- **Function Calling**: AI can interact with your tasks, retrieve data, and perform actions on your behalf.
- **YouTube Summarizer**: Automatically processes your YouTube watch history and generates daily summaries or insights (opt-in feature).

### 8. Notes

- **Personal Notes**: A dedicated space to create, view, edit, and delete personal notes.
- **Simple & Effective**: Each note has a title and content, with automatic tracking of the last update time.

### 10. Tutorial & Onboarding

- **Interactive Tutorial**: First-time user tutorial with step-by-step guidance through key features.
- **Contextual Tooltips**: Helpful hints and tips throughout the app for feature discovery.
- **Skip & Resume**: Users can skip tutorials or resume them later from settings.

### 11. User Profile & Settings

- **Personalized Experience**: Customize notification preferences for reminders and achievements.
- **Authentication Management**: Securely manage your account connected via Email/Password, Google, or GitHub.
- **Activity Log**: Comprehensive audit trail of all task interactions and system events.
- **Achievement Showcase**: Display unlocked achievements and progress toward new milestones.

### 12. Progressive Web App (PWA) & Offline Support

- **Install as Native App**: Add TaskFlow to your home screen on any device (iOS, Android, desktop) for app-like experience.
- **Offline Functionality**: Full offline support with service workers‚Äîaccess your tasks even without internet.
- **Offline Mode Detection**: Automatic detection of network status with dedicated offline page and graceful degradation.
- **Background Sync**: Smart synchronization when connection is restored.
- **App Shortcuts**: Quick access shortcuts in the PWA for common actions (Add Task, Today's Tasks, Gym, Health).
- **Push Notifications**: Receive native push notifications for task reminders and achievements (when installed as PWA).
- **Installable**: Beautiful install prompt with app icon and description for easy installation.

### 13. Today's View & Daily Planning

- **Visual Time Grid**: Interactive 24-hour timeline view showing your scheduled tasks with visual time blocks.
- **Scheduled vs Whole-Day Tasks**: Separate views for time-specific tasks and general daily tasks.
- **Quick Task Creation**: Add tasks directly to today's schedule with one click.
- **Time Block Visualization**: See your day at a glance with color-coded time blocks for each task.
- **Priority Indicators**: Visual priority badges on scheduled tasks.

### 14. User Experience & Design

- **Modern Dark UI**: A clean, dark-themed interface designed for focus and clarity with carefully crafted color palette.
- **Fully Responsive**: Pixel-perfect experience across desktop, tablet, and mobile devices with adaptive layouts.
- **Intuitive Navigation**: Animated sidebar with logical organization and quick access to all features.
- **Smooth Animations**: Polished micro-interactions powered by Framer Motion for delightful user experience.
- **Performant & Fast**:
  - **Optimistic UI Updates**: Instant feedback on actions like task creation or completion.
  - **Seamless Loading**: Utilizes React Suspense for smooth loading transitions without jarring layout shifts.
  - **Fast Navigation**: Built on the Next.js App Router for near-instant page loads.
  - **Efficient Caching**: Smart client-side caching for improved performance.
- **Accessibility**: Built with accessibility in mind‚Äîkeyboard navigation, ARIA labels, and screen reader support.
- **Visual Feedback**: Toast notifications, loading states, and error handling for clear communication.
- **Customizable Themes**: Personal color preferences for tasks and visual organization.

## üõ†Ô∏è Technology Stack

### Frontend

- **Next.js 15+**: React framework with App Router for optimal performance and server-side rendering.
- **React 19+**: Latest version for modern UI development with concurrent features.
- **TypeScript**: Type-safe development with full type coverage.
- **Tailwind CSS**: Utility-first CSS framework for responsive design with custom theme.
- **Framer Motion**: Smooth animations, transitions, and micro-interactions.
- **Lucide React**: Modern, customizable icon library with 1000+ icons.
- **React Hot Toast**: Beautiful toast notifications with custom styling.
- **React Tooltip**: Enhanced tooltip functionality for better UX.
- **Recharts**: Interactive, responsive charts for gym progress and analytics visualization.
- **Service Workers**: Offline support, background sync, and push notifications.

### Backend & Authentication

- **Firebase**: Comprehensive Backend-as-a-Service platform
  - **Firestore**: NoSQL real-time database for tasks, notes, health data, workouts, and AI chat history.
  - **Firebase Authentication**: Secure user authentication with Email/Password and Google sign-in.
  - **Firebase Cloud Messaging (FCM)**: Push notification delivery for web and mobile.
  - **Firebase Admin SDK**: Server-side operations with elevated privileges.
  - **Custom Tokens**: Bridge between NextAuth and Firebase for seamless authentication.
- **NextAuth.js v5**: Modern authentication framework integrating multiple providers:
  - **Credentials Provider**: Firebase custom tokens for Google Sign-In & Email/Password.
  - **GitHub OAuth**: Third-party authentication integration.
  - **Session Management**: Secure, encrypted JWT sessions.
- **Server Actions**: Next.js server-side functions for secure data operations.

### APIs & External Services

- **YouTube Data API**: Optional integration for watch history analysis and summarization.
- **openrouter**: AI models.

### Development Tools & Infrastructure

- **ESLint**: Code quality and style enforcement with custom rules.
- **TypeScript**: Static type checking with strict mode.
- **Git**: Version control with GitHub integration.
- **Environment Variables**: Secure configuration management for API keys and secrets.
- **Service Worker API**: Native browser API for offline functionality.

## üì± Application Structure

### Main Routes

- **`/`**: Landing page
- **`/webapp`** (Dashboard): Overview of tasks, analytics, and performance metrics with visual charts.
- **`/webapp/today`**: Today's view with interactive time grid and daily task planning.
- **`/webapp/tasks`**: Comprehensive task management interface with filtering and bulk actions.
- **`/webapp/calendar`**: Beautiful calendar view of tasks with month/week navigation.
- **`/webapp/completed`**: Archive of completed tasks with experience ratings and statistics.
- **`/webapp/notes`**: Personal notes management with create, edit, and delete functionality.
- **`/webapp/health`**: Nutrition tracking with USDA food database, calorie counting, and macro goals.
- **`/webapp/gym`**: Workout logging, exercise library, templates, and progress visualization.
- **`/webapp/ai`**: AI assistant chat interface with multi-model support and function calling.
- **`/webapp/inbox`**: Notification center with filtering, priority indicators, and read/unread management.
- **`/webapp/profile`**: User profile, achievements, and account settings.
- **`/login`**: Authentication page with Email/Password, Google, and GitHub sign-in options.
- **`/offline`**: Dedicated offline mode page shown when internet connection is lost.

## üîí Security Features

- **Secure Authentication**: Support for Google Sign-in, Email/Password, and GitHub OAuth, managed by NextAuth.js and Firebase.
- **Custom Firebase Tokens**: Secure bridge between NextAuth sessions and Firebase authentication.
- **Protected API Routes**: All API endpoints require authentication and validate user permissions.
- **Server Actions Security**: Server-side operations protected by NextAuth session validation.
- **Firestore Security Rules**: Granular security rules ensuring users can only access their own data.
- **Row-Level Security**: Each document includes userId validation at the database level.
- **Environment Variable Management**: Sensitive keys and configurations secured via environment variables.
- **Secure Session Handling**: Encrypted JWT sessions managed by NextAuth.js with httpOnly cookies.
- **XSS Protection**: Input sanitization and output encoding to prevent cross-site scripting.
- **CSRF Protection**: Built-in CSRF token validation for all state-changing operations.
- **Rate Limiting**: Protection against API abuse and brute force attacks.
- **Admin Operations**: Separate admin SDK operations with elevated privileges for system tasks.

## üöÄ Getting Started

1.  **Clone the repository**:
    ```bash
    git clone https://your-repository-url.git
    cd taskflow
    ```
2.  **Install dependencies**:
    ```bash
    npm install
    # or yarn install
    ```
3.  **Set up environment variables**:

    - Copy `.env.example` to `.env.local`:
      ```bash
      cp .env.example .env.local
      ```
    - **Required Variables**:
      - Firebase project configuration (API key, project ID, etc.)
      - `NEXTAUTH_SECRET` and `NEXTAUTH_URL` for authentication
      - Firebase Admin SDK credentials path
    - **Optional Variables**:
      - `GITHUB_ID` and `GITHUB_SECRET` for GitHub OAuth (callback URL: `http://localhost:3000/api/auth/callback/github`)
      - `USDA_API_KEY` from [USDA FoodData Central API](https://fdc.nal.usda.gov/api-guide.html) for nutrition tracking (free with registration)
      - `OPENAI_API_KEY` for OpenAI GPT models in AI assistant
      - `ANTHROPIC_API_KEY` for Claude models support
      - `GOOGLE_GENERATIVE_AI_API_KEY` for Gemini models support
      - `YOUTUBE_API_KEY` for YouTube summarizer feature (optional)

4.  **Run the development server**:

    ```bash
    npm run dev
    # or yarn dev
    ```

    Open [http://localhost:3000](http://localhost:3000) in your browser.

5.  **Access the application**:
    - Navigate to `/login` to create an account or sign in
    - After authentication, you'll be redirected to the dashboard at `/webapp`
    - The app works offline after your first visit‚Äîtry disconnecting from the internet!
    - Install as PWA by clicking the install prompt or using your browser's "Install App" option

## Some Typescript types

#### Task Schema

```typescript
interface Task {
  id: string;
  userId: string;
  title: string;
  description?: string;
  icon: string;
  color: string;
  isPriority: boolean;
  isReminder: boolean;
  delayCount: number;
  tags?: string[];
  createdAt: Date;
  updatedAt: Date;
  experience?: "bad" | "okay" | "good" | "best";
  location?: string;
  dueDate: Date; // Stored as Timestamp in Firestore, converted to Date in app
  startDate?: Date;
  startTime?: { hour: number; minute: number };
  completedAt?: Date;
  /**Delayed is pending but rescheduled */
  status: "pending" | "completed" | "delayed";
  isRepeating?: boolean;
  repetitionRule?: RepetitionRule;
  duration?: {
    hours: number;
    minutes: number;
  };
  risk?: boolean;
  points: number;
}
```

#### User Schema

```typescript
interface AppUser {
  uid: string;
  displayName: string;
  email: string;
  photoURL: string;
  createdAt: Date;
  provider: string;
  notifyReminders: boolean;
  notifyAchievements: boolean;
  rewardPoints: number;
  achievements: Achievement[];
  completedTasksCount: number;
  currentStreak: number;
  bestStreak: number;
  lastLoginAt?: Date;
  notesCount?: number;
}
```

## Firebase Authentication & Firestore Security Rules

#### Understanding the Authentication Issue

The main reason my firebase rules are failing is almost certainly that `request.auth` is null when your client-side code tries to access Firestore.

When you use NextAuth.js, it manages user authentication and creates its own session. However, this session is separate from Firebase Authentication. For `request.auth` to be populated in your Firestore security rules, the user must be explicitly signed into Firebase on the client using the Firebase SDK.

The fact that changing the tasks rule to `allow read, update, delete: if true;` works is a strong indicator that the client is not authenticated with Firebase.

#### The Solution: Custom Firebase Tokens

To fix this, I linked the NextAuth session to a Firebase session. When a user is authenticated with NextAuth, Next.js backend generates a Firebase custom token.

Client-side code fetches this custom token. The client then uses `signInWithCustomToken()` from the Firebase SDK to sign the user into Firebase.

Once the user is signed in with the custom token, `request.auth` will be correctly populated in your security rules, and they will start working as you expect.

A component like `AuthProvider.tsx` is the perfect place to orchestrate this client-side logic.

#### Server vs Client Authentication

On the server, you are authenticated with NextAuth, but you are not authenticated with Firebase.
These are two completely separate authentication systems.

Think of it like this:

- **NextAuth.js** is the Front Door Security Guard for your entire application building. They check your ID (from Google, GitHub, etc.) and give you a session cookie, which is like an ID badge that proves you're allowed inside the building.
- **Firebase** is a Secure Vault inside the building. This vault has its own separate, high-tech lock. Your building ID badge won't open the vault. You need a specific key card (a Firebase Auth token) that is only valid for the vault.

#### How `getServerSession(authOptions)` Works

The Front Door Security Guard (`getServerSession`) works because you carry your ID badge (the NextAuth session cookie) with you everywhere you go inside the building.

- When a user logs in through a NextAuth provider, NextAuth creates a secure, encrypted, httpOnly cookie in the user's browser.
- Every single request the browser makes to your Next.js server‚Äîwhether it's to render a Server Component, call a Route Handler, or execute a Server Action‚Äîautomatically includes this cookie.
- `getServerSession(authOptions)` is a server-side function that knows how to find this cookie in the incoming request, decrypt it using your `NEXTAUTH_SECRET`, and validate it.

So, on the server, you can always ask "Is this person allowed in the building?" and `getServerSession` will give you a reliable "yes" or "no" and tell you who they are, because the proof is sent with every request.

#### Why Firebase Fails on the Server (Without the Admin SDK)

**On the Client:** When we call `signInWithCustomToken` in the `FirebaseAuthProvider`, the Firebase client-side SDK establishes a session in the browser. It stores its own authentication token in the browser's IndexedDB. When your client-side code makes a request to Firestore, the SDK automatically attaches this token. Security rules see the token and say, "Okay, this key card is valid, open the vault."

**On the Server:** Your server-side code (in a Server Component or Server Action) is a completely separate environment. It has no browser and no access to the IndexedDB where the client's Firebase token is stored. The `signInWithCustomToken` call that happened in the browser is completely invisible to it.

When your server-side code tries to use the standard Firebase SDK (the one initialized in `firebase.ts`), it's like walking up to the vault with no key card at all. Firestore sees an unauthenticated request and correctly denies it, giving you the "Missing or insufficient permissions" error.

#### The Solution Implemented (Bridging the Gap)

**The Master Key (admin-sdk):** The Firebase Admin SDK is initialized with your service account credentials. This is the equivalent of a master key that can open any vault, bypassing the normal security rules. It's designed specifically for trusted server environments. This is why I created all the `-admin.ts` files‚Äîto ensure that any time our server needs to access the vault, it uses its master key.

## üåê Browser Support & Compatibility

TaskFlow is built with modern web standards and supports all major browsers:

| Browser              | Version | PWA Support | Offline Mode | Notes                           |
| -------------------- | ------- | ----------- | ------------ | ------------------------------- |
| **Chrome**           | 90+     | ‚úÖ Full     | ‚úÖ Full      | Recommended for best experience |
| **Edge**             | 90+     | ‚úÖ Full     | ‚úÖ Full      | Chromium-based, full support    |
| **Firefox**          | 88+     | ‚ö†Ô∏è Partial  | ‚úÖ Full      | PWA install may vary by OS      |
| **Safari**           | 14+     | ‚ö†Ô∏è Limited  | ‚úÖ Full      | iOS: Add to Home Screen         |
| **Opera**            | 76+     | ‚úÖ Full     | ‚úÖ Full      | Chromium-based                  |
| **Samsung Internet** | 14+     | ‚úÖ Full     | ‚úÖ Full      | Android devices                 |

**Requirements:**

- JavaScript enabled
- LocalStorage and IndexedDB support
- Service Worker support for offline functionality
- Modern CSS Grid and Flexbox support

**Mobile Support:**

- iOS 14+ (Safari, Chrome)
- Android 8+ (Chrome, Firefox, Samsung Internet)
- Responsive design adapts to all screen sizes
- Touch-optimized interface

## üéØ Use Cases

TaskFlow is perfect for:

- **Productivity Enthusiasts**: Power users who want an all-in-one solution for life management
- **Fitness & Health Conscious**: Track workouts and nutrition alongside daily tasks
- **Remote Workers**: Manage work tasks, habits, and personal goals in one place
- **Students**: Organize assignments, study schedules, and personal projects
- **Freelancers**: Track projects, deadlines, and maintain work-life balance
- **Digital Nomads**: Offline-first design perfect for unreliable internet connections
- **Habit Builders**: Gamification and streaks help build lasting positive habits
- **Data-Driven Individuals**: Comprehensive analytics and insights into your productivity

## ü§ù Contributing

This is currently a personal project, but contributions, issues, and feature requests are welcome! Feel free to:

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/AmazingFeature`)
3. Commit your changes (`git commit -m 'Add some AmazingFeature'`)
4. Push to the branch (`git push origin feature/AmazingFeature`)
5. Open a Pull Request

## üìû Contact & Support

For questions, feedback, or support:

- **Issues**: Open an issue on GitHub
- **Email**: ultrabrzitranzijent@gmail.com

---

**Built with ‚ù§Ô∏è by Josip ƒåunko**

_Making productivity beautiful, one task at a time._
